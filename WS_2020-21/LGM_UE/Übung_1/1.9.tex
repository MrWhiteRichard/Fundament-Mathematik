% --------------------------------------------------------------------------------

\begin{exercise}[24]

Sei $n$ groß, $k \leq 2^n$.
Geben Sie eine Formel in den Variablen $p_1, \dots, p_n$ an, die von genau $k$ Belegungen erfüllt wird.
Versuchen Sie, eine möglichst kleine Formel zu finden (mit etwa $\Landau{n}$ Symbolen).

\end{exercise}

% --------------------------------------------------------------------------------

\begin{solution}

Wir stellen zuerst $k \in \{0,\dots,2^n-1\}$ binär dar:
\begin{align*}
  k = \sum_{i=0}^{n-1}a_i2^i, \quad a_i \in \{0,1\}.
\end{align*}
Als nächstes definieren wir für $i \in \{0,\dots,n-1\}$ disjunkte Mengen $B_i$
von Belegungen mit $|B_i| = 2^i$ wie folgt:
\begin{align*}
  B_{n-1} &:= \{b: b(p_1) = 0\} \\
  B_{n-2} &:= \{b: b(p_1) = 1, b(p_2) = 0\} \\
  &\vdots \\
  B_{1} &:= \{b: b(p_1) = 1, \dots, b(p_{n-2}) = 1, b(p_{n-1}) = 0\} \\
  B_{0} &:= \{b: b(p_1) = 1, \dots, b(p_{n-1}) = 1, b(p_{n}) = 0\}.
\end{align*}
Jetzt müssen wir noch Formeln $A_i$ finden, sodass die Menge aller Belegungen die $A_i$
erfüllen genau $B_i$ ist. Das funktioniert so:
\begin{align*}
  A_{n-1} &:= \neg p_1 \\
  A_{n-2} &:= p_1 \land \neg p_2 \\
  &\vdots \\
  A_{1} &:= p_1 \land \dots \land p_{n-2} \land \neg p_{n-1}\\
  A_{0} &:= p_1 \land \dots \land p_{n-1} \land \neg p_{n}\\
\end{align*}
Die Disjunktion aller $A_i$ liefert dann schließlich eine Formel, die von der
Vereinigung aller $B_i$ erfüllt wird.
Da die Mengen $B_i$ paarweise disjunkt sind, ist die Mächtigkeit von der Vereinigung
gleich der Summe der einzelnen Mächtigkeiten.

Für vorgegebenes $k$ betrachten wir also die Disjunktion aller $A_i$ mit $i \in \{i \in \{0,\dots,n-1\}: a_i \neq 0 \}$. \\
Wir verwenden also maximal $\sum_{i=0}^{n-1}2(n-i) + n - 1 = n^2 + 1 = O(n^2)$ Symbole. Es geht also anscheinend noch besser.

Zur Vollständigkeit halber sei noch gesagt, dass für $k = 2^n$ einfach die Formel $T$ gewählt werden kann.

Zusatz: Wir überlegen uns für $0 < l < m \leq n$ und die Formel $A_{n-l} \lor A_{n-m}$ die Äquivalenz
\begin{align*}
(p_1 \land p_2 \land \dots \land p_{l-1} \land \neg p_l) \lor (p_1 \land p_2 \land \dots \land p_{m-1} \land \neg p_m) \land \neg p_l) \lor (p_1 \land p_2 \land \dots \land p_{n-1} \land \neg p_n) \\
\Leftrightarrow (p_1 \land \dots \land p_{l-1}) \land (\neg p_l \lor (p_l \land \dots \land p_{m-1} \land \neg p_m) \lor (p_l \land \dots \land p_{n-1} \land \neg p_n)) \\
\Leftrightarrow (p_1 \land \dots \land p_{l-1}) \land (\neg p_l \lor ((p_l \land \dots \land p_{m-1}) \land (\neg p_m \lor (p_m \land \dots \land p_{n-1} \land \neg p_n)))) \\
\Leftrightarrow (p_1 \land \dots \land p_{l-1}) \land (\neg p_l \lor (p_l \land \dots \land p_{m-1})) \land (\neg p_l \lor \neg p_m \lor (p_m \land \dots \land p_{n-1} \land \neg p_n))
\end{align*}
gibt für $1 = n_0 \leq n_1 < \dots < n_l$ Anlass zur allgemeinen Formel 
\begin{align*}
\lor_{i=1}^l \left(\neg p_{n_i} \land \bigwedge_{j=1}^{n_i - 1} p_j \right)
\stackrel{?}{\Leftrightarrow} \bigwedge_{i=0}^{l - 1} \left(\left(\lor_{j=1}^i \neg p_{n_j}\right) \lor \left(\bigwedge_{k = n_i + 1}^{n_{i+1} - 1} p_k\right)\right) 
\end{align*}
aber die Formel schaut auch nicht kürzer aus. 
\begin{align*}
content...
\end{align*}
\end{solution}

% --------------------------------------------------------------------------------

\begin{solution}

Man kann auch eine leicht einzusehende Formel mit $\Landau{n \cdot 2^n}$ Symbolen konstruieren.
Dazu betrachten wir die Binärdarstellungen.

\begin{align*}
  \Forall k = 0, \ldots, 2^n - 1:
  \ExistsOnlyOne k_1, \ldots, k_n \in \Bbraces{0, 1}:
  k = \sum_{i=1}^n k_i 2^{i-1}
\end{align*}

In der folgenden Tabelle ist die Formel, die wir für allgemeine $k$ konstruieren werden, mal für die ersten paar $k$ aufgedröselt.
In der letzten Spalte steht jedes $W$ bzw. $F$, an der $k$-ten Stelle von links, für ein $p_k$ bzw. $\neg p_k$.
Diese werden horizontal mit $\land$ und anschließend vertikal mit $\lor$ verknüpft. \\

\begin{tabular}{|l|l|l|l|l|l|}
  \hline
  $k$ & $1$ & $2$ & $3$ & $4$ & $5$ \\
  \hline
  $k-1$ & $0$ & $1$ & $2$ & $3$ & $4$ \\
  \hline
  Binärdarschreibweise von $k-1$ & $0$ & $1$ & $10$ & $11$ & $100$ \\
  \hline
  Formel (angedeutet) & $W \cdots W$ & \makecell{$W W \cdots W$ \\ $F W \cdots W$} & \makecell{$W W W \cdots W$ \\ $F W W \cdots W$ \\ $W F W \cdots W$} & \makecell{$W W W \cdots W$ \\ $F W W \dots W$ \\ $W F W \dots W$ \\ $F F W \cdots W$} & \makecell{$W W W W \cdots W$ \\ $F W W W \dots W$ \\ $W F W W \dots W$ \\ $F F W W \cdots W$ \\ $W W F W \cdots W$} \\
  \hline
\end{tabular} \\

Um unsere Formel möglichst \Quote{schön} hinzuschreiben, definieren wir folgenden Ausdruck.

\begin{align*}
  (b \cdot \neg) p :=
  \begin{cases}
    p,      & b = 1 \\
    \neg p, & b = 0
  \end{cases},
  \quad
  b \in \Bbraces{0, 1}
\end{align*}

Die folgende Formel ist nun für genau $k = 0, \ldots, 2^n$ Belegungen von $p_1, \ldots, p_n$ wahr.
Man beachte, dass die leere Disjunktion ($k = 0$) stets falsch ist.

\begin{align*}
  \bigvee_{\ell = 0}^{k-1}
  \bigwedge_{i=1}^n
  (\ell_i \cdot \neg) p_i
\end{align*}

\end{solution}

% --------------------------------------------------------------------------------
