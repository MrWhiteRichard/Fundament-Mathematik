% --------------------------------------------------------------------------------

\begin{exercise}[Rayleigh distribution]

Let $X_1, \dots, X_n$ be a random sample with Rayleigh distribution

\begin{align*}
    f(x \mid \theta)
    =
    \begin{cases}
        \frac{x}{\theta^2} \exp*{-\frac{x^2}{2 \theta^2}},
        & x \geq 0 \\
        0,
        & x < 0
    \end{cases},
\end{align*}

where $\theta > 0$ is unknown.

\begin{enumerate}[label = (\alph*)]
    \item Find the method of moments estimator of $\theta$.
    \item Find teh MLE of $\theta$ and its asymptotic variance.
\end{enumerate}

\textit{Hint}:
Show that the first two moments are $\E X = \theta \sqrt \frac{\pi}{2}$ and $\E X^2 = 2 \theta^2$.

\end{exercise}

% --------------------------------------------------------------------------------

\begin{solution}

\begin{align*}
    \E X^k
    & =
    \Int[-\infty][\infty]
    {
        x^k f_\theta(x)
    }{x} \\
    & =
    \Int[-\infty][\infty]
    {
        x^k \frac{x}{\theta^2} \exp*{-\frac{x^2}{2 \theta^2}} \mathbf 1_{(0, \infty)}(x)
    }{x} \\
    & =
    \frac{1}{\theta^2}
    \Int[0][\infty]
    {
        x^{k+1}
        \exp*{-\frac{x^2}{2 \theta^2}}
    }{x} \\
    & \stackrel{!}{=}
    \frac{1}{\theta^2}
    \Int[0][\infty]
    {
        (2 \theta^2 y)^{(k + 1) / 2}
        \exp*{-y}
        \frac{\theta}{\sqrt{2 y}}
    }{y} \\
    & =
    \theta^k 2^{k / 2}
    \Int[0][\infty]
    {
        \exp*{-y}
        y^{1 + k / 2 - 1}
    }{y} \\
    & =
    (\theta \sqrt 2)^k
    \Gamma(1 + k / 2)
\end{align*}

For \enquote{!} we used

\begin{align*}
    y = \frac{x^2}{2 \theta^2}
    \implies
    \begin{cases}
        x^{k+1} = (2 \theta^2 y)^{(k + 1) / 2} \\
        \derivative[y][x] = \frac{2 x}{2 \theta^2} = \frac{1}{\theta^2} \sqrt{2 \theta^2 y} = \frac{\sqrt{2 y}}{\theta}
        \implies
        \mathrm d x = \frac{\theta}{\sqrt{2 y}} \mathrm d y
    \end{cases}
\end{align*}

\begin{enumerate}[label = (\alph*)]

    \item

    \begin{align*}
        \hat \theta \sqrt \frac{\pi}{2} = \E_{\hat \theta} \stackrel{!}{=} \frac{1}{n} \sum_{i=1}^n X_i = \bar X_n
        \iff
        \hat \theta = \sqrt \frac{2}{\pi} \bar X_n
    \end{align*}

    \item

    \begin{align*}
        L(\theta \mid x)
        & =
        f_\theta(x) \\
        & =
        \prod_{i=1}^n
            f_\theta(x_i) \\
        & =
        \prod_{i=1}^n
            \frac{x_i}{\theta} \exp*{-\frac{x_i^2}{2 \theta^2}} \mathbf 1_{0, \infty}(x_i)
    \end{align*}

    W.l.o.g. we can only consider $x \in \R_+^n$ and drop the factores $x_i$ and $\mathbf 1_{0, \infty}(x_i)$ for $i = 1, \dots, n$.

    \begin{align*}
        \ell(\theta \mid x)
        & =
        \log
        \pbraces
        {
            \prod_{i=1}^n
            \frac{x_i}{\theta} \exp*{-\frac{x_i^2}{2 \theta^2}} \mathbf 1_{0, \infty}(x_i)
        } \\
        & =
        \sum_{i=1}^n
            \log
            \pbraces
            {
                \frac{x_i}{\theta} \exp*{-\frac{x_i^2}{2 \theta^2}} \mathbf 1_{0, \infty}(x_i)
            } \\
        & =
        \sum_{i=1}^n
            \log \frac{1}{\theta^2}
            +
            \log \exp*{-\frac{x_i^2}{2 \theta^2}} \\
        & =
        \sum_{i=1}^n -\log \theta^2
        +
        \sum_{i=1}^n -\frac{x_i^2}{2 \theta^2} \\
        & =
        -n \log \theta^2 - \frac{1}{2 \theta^2} |x|^2
    \end{align*}

    \begin{align*}
        &
        0 \stackrel{!}{=} \derivative{\theta} \ell(\theta \mid x) \Big |_{\theta = \hat \theta} = -n \frac{2 \hat \theta}{\hat \theta^2} - \frac{1}{2} (-2) \frac{1}{\hat \theta^3} |x|^2 = \frac{|x|^2}{\hat \theta^3} - \frac{2 n }{\hat \theta} \\
        & \iff
        \frac{2 n}{\hat \theta} = \frac{|x|^2}{\hat \theta^3} \\
        & \iff
        2 n \hat \theta^3 = |x|^2 \hat \theta \\
        & \iff
        \hat \theta = \pm \sqrt \frac{|x|^2}{2 n}
    \end{align*}

    \begin{align*}
        &
        0 \stackrel{!}{\geq} \derivative[][2]{\theta} \ell(\theta \mid x) \Big |_{\theta = \hat \theta} = (-3) \frac{|x|^2}{\hat \theta^4} - (-1) \frac{2 n}{\hat \theta^2} \\
        & \iff
        \frac{2 n}{\hat \theta^2} \leq \frac{2 |x|^2}{\hat \theta^4} \\
        & \iff
        3 |x|^2 \geq 2 n \hat \theta^2 = 2 n \sqrt \frac{|x|}{2 n}^2 = |x|
    \end{align*}

    Hence, we get

    \begin{align*}
        \hat \theta(X_1, \dots, X_n)
        =
        \sqrt
        {
            \frac{1}{2}
            \frac{1}{n}
            \sum_{i=1}^n
                X_i^2
        }
        =
        \cdots.
    \end{align*}

    If we now let

    \begin{align*}
        Y_i := X_i^2,
        \quad
        \bar Y_n := \frac{1}{n} \sum_{i=1}^n Y_i,
    \end{align*}

    the Law Of Large Numbers yields

    \begin{align*}
        \bar Y_n \xrightarrow[n \to \infty]{\text d} \E Y_i = \E X_i^2 = 2 \theta^2.
    \end{align*}

    Furthermore, Slutsky's theorem now gives us

    \begin{align*}
        \cdots
        =
        \sqrt \frac{\bar Y_n}{2}
        \xrightarrow[n \to \infty]{\text d}
        \sqrt \frac{2 \theta^2}{2}
        =
        \theta.
    \end{align*}

\end{enumerate}

\end{solution}

% --------------------------------------------------------------------------------
