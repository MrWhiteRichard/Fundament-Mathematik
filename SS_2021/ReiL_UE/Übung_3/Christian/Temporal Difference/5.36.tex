% -------------------------------------------------------------------------------- %

\begin{exercise}

Show that an action-value version of (6.6) holds for the action-value form of the TD error $\delta_t = R_{t+1} + \gamma Q(S_{t+1},A_{t+1}) - Q(A_t,S_t)$, again assuming that the values don't change from step to step.
\end{exercise}

% -------------------------------------------------------------------------------- %

\begin{solution}

We just do the calculations with $Q(S_t,A_t)$ instead of $V(S_t)$

\begin{align*}
  G_t - Q(S_t, A_t)
  &=
  R_{t+1} + \gamma G_{t+1} - Q(S_t, A_t) + \gamma Q(S_{t+1},A_{t+1}) - \gamma Q(S_{t+1},A_{t+1})\\
  &=
  \delta_t + \gamma\big(G_{t+1} - Q(S_{t+1},A_{t+1})\big) \\
  &=
  \delta_t + \gamma \delta_{t+1} + \gamma^2\big(G_{t+2} - Q(S_{t+2},A_{t+2})\big) \\
  &=
  \delta_t + \gamma \delta_{t+1} + \gamma^2 \delta_{t+2} + \cdots +
  \gamma^{T-t-1}\delta_{T-1} + \gamma^{T-t}\big(G_T - Q(S_T,A_T)\big) \\
  &=
  \delta_t + \gamma \delta_{t+1} + \gamma^2 \delta_{t+2} + \cdots +
  \gamma^{T-t-1}\delta_{T-1} + \gamma^{T-t}\big(0-0\big) \\
  &=
  \sum_{k=t}^{T-1}\gamma^{k-t}\delta_k
\end{align*}

\end{solution}

% -------------------------------------------------------------------------------- %
