% -------------------------------------------------------------------------------- %

\begin{exercise}

Derive the weighted-average update rule \eqref{eq:5.8} from \eqref{eq:5.7}. Follow the pattern of the derivation of the unweighted rule \eqref{eq:2.3}.
\begin{align} \label{eq:5.8} \tag{5.8}
    V_{n+1}
    \doteq
    V_n + \frac{W_n}{C_n} \bbraces{G_n - V_n},
    \quad
    n \geq 1
\end{align}

\begin{align} \label{eq:5.7} \tag{5.7}
    V_n
    \doteq
    \frac
    {
        \sum_{k=1}^{n-1} W_k G_k
    }{
        \sum_{k=1}^{n-1} W_k
    },
    \quad
    n \geq 2
\end{align}

\begin{align} \label{eq:2.3} \tag{2.3}
    Q_{n+1}
    =
    Q_n + \frac{1}{n} \bbraces{R_n - Q_n}
\end{align}
\end{exercise}

% -------------------------------------------------------------------------------- %

\begin{solution}

We note that the $C_k$ are defined by

\begin{align*}
  C_0 &= 0 \\
  C_{n+1} &= C_n + W_{n+1}, \quad n \in \N
\end{align*}

So we can easily see that
\begin{align*}
  C_n = \sum_{i=1}^n W_i
\end{align*}

We now follow the pattern of \eqref{eq:2.3}:

\begin{align*}
  V_{n+1}
  &=
  \frac
  {
      \sum_{k=1}^{n} W_k G_k
  }{
      \sum_{k=1}^{n} W_k
  } \\
  &=
  \frac{1}{\sum_{k=1}^{n} W_k}
  \Big(
    W_n G_n + \sum_{k=1}^{n-1} W_k G_k
  \Big)
  =
  \frac{1}{\sum_{k=1}^{n} W_k}
  \Big(
    W_n G_n + \frac{\sum_{k=1}^{n-1} W_k G_k}{\sum_{k=1}^{n-1} W_k}\cdot \sum_{k=1}^{n-1} W_k
  \Big) \\
  &=
  \frac{1}{\sum_{k=1}^{n} W_k}
  \Big(
    W_n G_n + V_n \cdot \big(\sum_{k=1}^{n} W_k - W_n\big)
  \Big)
  =
  V_n + \frac{W_n}{\sum_{k=1}^{n} W_k}\Big(G_n -V_n\Big) \\
  &=
  V_n + \frac{W_n}{C_n} \bbraces{G_n - V_n}
\end{align*}
\end{solution}

% -------------------------------------------------------------------------------- %
