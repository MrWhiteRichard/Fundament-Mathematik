% ---------------------------------------------------------------- %

\begin{exercise}[Exercise 11.1]

Convert the equation of $n$-step off-policy TD \eqref{eq:7.9} to semi-gradient form.
Give accompanying definitions of the return for both the episodic and continuing cases.

\end{exercise}

% ---------------------------------------------------------------- %

\begin{solution}

\begin{align} \label{eq:7.9} \tag{7.9}
    V_{t+n}(S_t)
    \doteq
    V_{t+n-1}(S_t)
    +
    \alpha \rho_{t:t+n-1} [G_{t:t+n} - V_{t+n-1}(S_t)],
    \quad
    0 \leq t < T
\end{align}

\begin{align*}
    \mathbf w_{t+n}
    \doteq
    \mathbf w_{t+n-1}
    +
    \alpha \rho_t \cdots \rho_{t+n-1} [G_{t:t+n} - \hat v(S_t, \mathbf w_{t+n-1})] \nabla \hat v(S_t, \mathbf w_{t+n-1}),
    \quad
    0 \leq t < T
\end{align*}

\begin{align}
    G_{t:t+n}
    & \doteq
    R_{t+1} + \cdots + \gamma^{n-1} R_{t+n} + \gamma^n \hat v(S_{t+n}, \mathbf w_{t+n-1}),
    \label{eq:episodic}
    \tag{episodic} \\
    G_{t:t+n}
    & \doteq
    R_{t+1} - \bar R_t + \cdots + R_{t+n} - \bar R_{t+n-1} + \hat v(S_{t+n}, \mathbf w_{t+n-1})
    \label{eq:continuing}
    \tag{continuing}
\end{align}

Notice, that \eqref{eq:episodic} is in fact nothing but \eqref{eq:12.1}.

\end{solution}

% ---------------------------------------------------------------- %