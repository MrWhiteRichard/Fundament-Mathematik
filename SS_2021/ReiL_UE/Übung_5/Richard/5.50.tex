% ---------------------------------------------------------------- %

\begin{exercise}[Exercise 12.1]

Just as the return can be written recursively in terms of the first reward and itself one-step later \eqref{eq:3.9}, so can the $\lambda$-return.
Derive the analogous recursive relationship for \eqref{eq:12.2} and \eqref{eq:12.1}.

\end{exercise}

% ---------------------------------------------------------------- %

\begin{solution}

\begin{align}
    G_t
    & \doteq
    R_{t+1} + \gamma R_{t+2} + \gamma^2 R_{t+3} + \gamma^3 R_{t+4} + \cdots \notag \\
    & =
    R_{t+1} + \gamma (R_{t+2} + \gamma R_{t+3} + \gamma^2 R_{t+4} \cdots) \notag \\
    & =
    R_{t+1} + \gamma G_{t+1} \label{eq:3.9} \tag{3.9}
\end{align}

\begin{align} \label{eq:12.1} \tag{12.1}
    G_{t:t+n}
    \doteq
    R_{t+1} + \gamma R_{t+2} + \cdots + \gamma^{n-1} R_{t+n} + \gamma^n \hat v(S_{t+n}, \mathbf w_{t+n-1}),
    \quad
    0 \leq t \leq T - n
\end{align}

\begin{align} \label{eq:12.2} \tag{12.2}
    G_t^\lambda
    & \doteq
    (1 - \lambda)
    \sum_{n=1}^\infty
        \lambda^{n-1}
        G_{t:t+n} \\
    & \stackrel
    {
        \eqref{eq:12.1}
    }{=}
    (1 - \lambda)
    \sum_{n=1}^\infty
        \lambda^{n-1}
        (R_{t+1} + \gamma R_{t+2} + \cdots + \gamma^{n-1} R_{t+n} + \gamma^n \hat v(S_{t+n}, \mathbf w_{t+n-1})) \notag \\
    & =
    (1 - \lambda)
    \sum_{n=1}^\infty
        \lambda^{n-1}
        R_{t+1}
    +
    (1 - \lambda) \gamma \hat v(S_{t+1}, \mathbf w_t) \notag \\
    & \quad +
    (1 - \lambda)
    \sum_{n=2}^\infty
        \lambda^{n-1}
        \gamma
        (R_{t+2} + \cdots + \gamma^{n-2} R_{t+n} + \gamma^{n-1} \hat v(S_{t+n}, \mathbf w_{t+n-1})) \notag \\
    & =
    (1 - \lambda)
    \frac{1}{1 - \lambda}
    R_{t+1}
    +
    (1 - \lambda) \gamma \hat v(S_{t+1}, \mathbf w_t) \notag \\
    & \quad +
    (1 - \lambda)
    \sum_{n=1}^\infty
        \lambda^n
        \gamma
        (R_{t+2} + \cdots + \gamma^{n-1} R_{t+n+1} + \gamma^n \hat v(S_{t+n+1}, \mathbf w_{t+n})) \notag \\
    & =
    R_{t+1}
    +
    (1 - \lambda) \gamma \hat v(S_{t+1}, \mathbf w_t) \notag \\
    & \quad +
    \lambda
    \gamma
    (1 - \lambda)
    \sum_{n=1}^\infty
        \lambda^{n-1}
        (R_{(t+1)+1} + \cdots + \gamma^{n-1} R_{(t+1)+n} + \gamma^n \hat v(S_{(t+1)+n}, \mathbf w_{(t+1)+n-1})) \notag \\
    & =
    R_{t+1} + \gamma \pbraces{(1 - \lambda) \hat v(S_{t+1}, \mathbf w_t) + \lambda G_{t+1}^\lambda} \tag{12.18$^\prime$}
\end{align}

\end{solution}

% ---------------------------------------------------------------- %